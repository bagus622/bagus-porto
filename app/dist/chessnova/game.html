<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Chess - ChessNova</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="game-page">
    <!-- Navigation -->
    <nav class="navbar navbar-compact">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚ôî</span>
                <span class="logo-text">ChessNova</span>
            </a>
            <div class="nav-center">
                <span class="game-mode-indicator" id="gameModeIndicator">vs Player</span>
            </div>
            <div class="nav-actions">
                <button class="nav-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <button class="nav-btn" id="soundBtn" title="Toggle Sound">üîä</button>
                <a href="index.html" class="nav-btn" title="Home">üè†</a>
            </div>
        </div>
    </nav>

    <!-- Main Game Container -->
    <main class="game-container">
        <!-- Left Panel: Game Info -->
        <aside class="game-panel left-panel">
            <!-- Player Info (Top) -->
            <div class="player-card opponent">
                <div class="player-avatar" id="opponentAvatar">ü§ñ</div>
                <div class="player-info">
                    <span class="player-name" id="opponentName">Computer</span>
                    <span class="player-rating" id="opponentRating">1500</span>
                </div>
                <div class="player-timer" id="opponentTimer">10:00</div>
            </div>

            <!-- Captured Pieces -->
            <div class="captured-section">
                <div class="captured-pieces" id="capturedByWhite"></div>
                <div class="material-advantage" id="materialAdvantage"></div>
                <div class="captured-pieces" id="capturedByBlack"></div>
            </div>

            <!-- Player Info (Bottom) -->
            <div class="player-card current-player">
                <div class="player-avatar" id="playerAvatar">üë§</div>
                <div class="player-info">
                    <span class="player-name" id="playerName">You</span>
                    <span class="player-rating" id="playerRating">1500</span>
                </div>
                <div class="player-timer active" id="playerTimer">10:00</div>
            </div>
        </aside>

        <!-- Center: Chess Board -->
        <div class="board-section">
            <div class="board-container" id="boardContainer">
                <div class="board-coordinates files">
                    <span>a</span><span>b</span><span>c</span><span>d</span>
                    <span>e</span><span>f</span><span>g</span><span>h</span>
                </div>
                <div class="board-coordinates ranks">
                    <span>8</span><span>7</span><span>6</span><span>5</span>
                    <span>4</span><span>3</span><span>2</span><span>1</span>
                </div>
                <div class="chess-board" id="chessBoard">
                    <!-- Board squares generated by JS -->
                </div>
                <div class="board-overlay" id="boardOverlay"></div>
                <!-- Check/Checkmate Indicator -->
                <div class="check-indicator" id="checkIndicator"></div>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls">
                <button class="control-btn" id="mobileUndo" title="Undo">‚Ü©Ô∏è</button>
                <button class="control-btn" id="mobileFlip" title="Flip Board">üîÑ</button>
                <button class="control-btn" id="mobileMenu" title="Menu">‚ò∞</button>
            </div>
        </div>

        <!-- Right Panel: Controls & History -->
        <aside class="game-panel right-panel">
            <!-- Game Status -->
            <div class="status-box">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span class="status-text">White to move</span>
                </div>
                <div class="turn-indicator" id="turnIndicator">Your Turn</div>
            </div>

            <!-- Move History -->
            <div class="history-section">
                <h3 class="panel-title">üìú Move History</h3>
                <div class="move-history" id="moveHistory">
                    <div class="history-header">
                        <span>#</span>
                        <span>White</span>
                        <span>Black</span>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- Moves will be added here -->
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="controls-section">
                <h3 class="panel-title">üéÆ Controls</h3>
                <div class="control-grid">
                    <button class="control-btn" id="undoBtn" title="Undo (Ctrl+Z)">
                        <span>‚Ü©Ô∏è</span>
                        <label>Undo</label>
                    </button>
                    <button class="control-btn" id="redoBtn" title="Redo (Ctrl+Y)">
                        <span>‚Ü™Ô∏è</span>
                        <label>Redo</label>
                    </button>
                    <button class="control-btn" id="flipBtn" title="Flip Board (F)">
                        <span>üîÑ</span>
                        <label>Flip</label>
                    </button>
                    <button class="control-btn" id="hintBtn" title="Get Hint (H)">
                        <span>üí°</span>
                        <label>Hint</label>
                    </button>
                </div>
                <div class="control-actions">
                    <button class="btn btn-outline btn-sm" id="drawBtn">ü§ù Offer Draw</button>
                    <button class="btn btn-danger btn-sm" id="resignBtn">üè≥Ô∏è Resign</button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="newGameBtn">üéÆ New Game</button>
                <button class="btn btn-secondary" id="saveGameBtn">üíæ Save Game</button>
            </div>
        </aside>
    </main>

    <!-- New Game Modal -->
    <div class="modal" id="newGameModal">
        <div class="modal-content modal-large">
            <span class="modal-close" onclick="closeNewGameModal()">&times;</span>
            <h2>üéÆ New Game</h2>
            
            <div class="game-options">
                <div class="option-group">
                    <label>Game Mode</label>
                    <div class="option-buttons" id="modeOptions">
                        <button class="option-btn active" data-mode="pvp">üë• vs Player</button>
                        <button class="option-btn" data-mode="ai">ü§ñ vs AI</button>
                    </div>
                </div>

                <div class="option-group" id="difficultyGroup" style="display: none;">
                    <label>AI Difficulty</label>
                    <div class="option-buttons" id="difficultyOptions">
                        <button class="option-btn" data-diff="easy">üå± Easy</button>
                        <button class="option-btn active" data-diff="medium">üéØ Medium</button>
                        <button class="option-btn" data-diff="hard">üî• Hard</button>
                    </div>
                </div>

                <div class="option-group">
                    <label>Time Control</label>
                    <div class="option-buttons" id="timeOptions">
                        <button class="option-btn" data-time="1">‚ö° 1 min</button>
                        <button class="option-btn active" data-time="5">üî• 5 min</button>
                        <button class="option-btn" data-time="10">‚è±Ô∏è 10 min</button>
                        <button class="option-btn" data-time="0">‚ôæÔ∏è Unlimited</button>
                    </div>
                </div>

                <div class="option-group">
                    <label>Play As</label>
                    <div class="option-buttons" id="colorOptions">
                        <button class="option-btn" data-color="white">‚ö™ White</button>
                        <button class="option-btn active" data-color="random">üé≤ Random</button>
                        <button class="option-btn" data-color="black">‚ö´ Black</button>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeNewGameModal()">Cancel</button>
                <button class="btn btn-primary btn-glow" id="startGameBtn">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSettingsModal()">&times;</span>
            <h2>‚öôÔ∏è Settings</h2>
            
            <div class="settings-group">
                <label>Board Theme</label>
                <div class="theme-options" id="boardThemes">
                    <div class="theme-option active" data-theme="classic">
                        <div class="theme-preview classic"></div>
                        <span>Classic</span>
                    </div>
                    <div class="theme-option" data-theme="blue">
                        <div class="theme-preview blue"></div>
                        <span>Blue</span>
                    </div>
                    <div class="theme-option" data-theme="green">
                        <div class="theme-preview green"></div>
                        <span>Green</span>
                    </div>
                    <div class="theme-option" data-theme="purple">
                        <div class="theme-preview purple"></div>
                        <span>Purple</span>
                    </div>
                    <div class="theme-option" data-theme="dark">
                        <div class="theme-preview dark"></div>
                        <span>Dark</span>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <label>Piece Style</label>
                <div class="piece-options" id="pieceStyles">
                    <button class="option-btn active" data-style="unicode">Unicode</button>
                    <button class="option-btn" data-style="letters">Letters</button>
                </div>
            </div>

            <div class="settings-group">
                <label>Sound Effects</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Enable sounds</span>
                </label>
            </div>

            <div class="settings-group">
                <label>Show Legal Moves</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="legalMovesToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Highlight legal moves</span>
                </label>
            </div>

            <div class="settings-group">
                <label>Show Last Move</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="lastMoveToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Highlight last move</span>
                </label>
            </div>

            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content modal-center">
            <div class="game-over-icon" id="gameOverIcon">üèÜ</div>
            <h2 id="gameOverTitle">Checkmate!</h2>
            <p id="gameOverMessage">White wins by checkmate!</p>
            <div class="game-over-stats" id="gameOverStats">
                <!-- Stats will be added here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="analyzeGame()">üìä Analyze</button>
                <button class="btn btn-primary btn-glow" onclick="newGameFromModal()">üéÆ New Game</button>
            </div>
        </div>
    </div>

    <!-- Promotion Modal -->
    <div class="modal" id="promotionModal">
        <div class="modal-content modal-small">
            <h3>Choose Promotion</h3>
            <div class="promotion-options" id="promotionOptions">
                <button class="promotion-piece" data-piece="q">‚ôï</button>
                <button class="promotion-piece" data-piece="r">‚ôñ</button>
                <button class="promotion-piece" data-piece="b">‚ôó</button>
                <button class="promotion-piece" data-piece="n">‚ôò</button>
            </div>
        </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas" class="confetti-canvas"></canvas>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/timer.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
